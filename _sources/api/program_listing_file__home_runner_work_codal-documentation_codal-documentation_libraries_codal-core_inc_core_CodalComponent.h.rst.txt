
.. _program_listing_file__home_runner_work_codal-documentation_codal-documentation_libraries_codal-core_inc_core_CodalComponent.h:

Program Listing for File CodalComponent.h
=========================================

|exhale_lsh| :ref:`Return to documentation for file <file__home_runner_work_codal-documentation_codal-documentation_libraries_codal-core_inc_core_CodalComponent.h>` (``/home/runner/work/codal-documentation/codal-documentation/libraries/codal-core/inc/core/CodalComponent.h``)

.. |exhale_lsh| unicode:: U+021B0 .. UPWARDS ARROW WITH TIP LEFTWARDS

.. code-block:: cpp

   /*
   The MIT License (MIT)
   
   Copyright (c) 2016 British Broadcasting Corporation.
   This software is provided by Lancaster University by arrangement with the BBC.
   
   Permission is hereby granted, free of charge, to any person obtaining a
   copy of this software and associated documentation files (the "Software"),
   to deal in the Software without restriction, including without limitation
   the rights to use, copy, modify, merge, publish, distribute, sublicense,
   and/or sell copies of the Software, and to permit persons to whom the
   Software is furnished to do so, subject to the following conditions:
   
   The above copyright notice and this permission notice shall be included in
   all copies or substantial portions of the Software.
   
   THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
   IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
   FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL
   THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
   LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
   FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
   DEALINGS IN THE SOFTWARE.
   */
   
   #ifndef CODAL_COMPONENT_H
   #define CODAL_COMPONENT_H
   
   #include "CodalConfig.h"
   #include "ErrorNo.h"
   
   // Enumeration of core components.
   #define DEVICE_ID_BUTTON_A            1                         // IDs used by commonly used components. Used by convention.
   #define DEVICE_ID_BUTTON_B            2
   #define DEVICE_ID_BUTTON_AB           3
   #define DEVICE_ID_BUTTON_RESET        4
   #define DEVICE_ID_ACCELEROMETER       5
   #define DEVICE_ID_COMPASS             6
   #define DEVICE_ID_DISPLAY             7
   #define DEVICE_ID_THERMOMETER         8
   #define DEVICE_ID_RADIO               9
   #define DEVICE_ID_RADIO_DATA_READY    10
   #define DEVICE_ID_MULTIBUTTON_ATTACH  11
   #define DEVICE_ID_SERIAL              12
   #define DEVICE_ID_GESTURE             13
   #define DEVICE_ID_SYSTEM_TIMER        14
   #define DEVICE_ID_SCHEDULER           15
   #define DEVICE_ID_COMPONENT           16
   #define DEVICE_ID_LIGHT_SENSOR        17
   #define DEVICE_ID_TOUCH_SENSOR        18
   #define DEVICE_ID_SYSTEM_DAC          19
   #define DEVICE_ID_SYSTEM_MICROPHONE   20
   #define DEVICE_ID_SYSTEM_LEVEL_DETECTOR 21
   #define DEVICE_ID_SYSTEM_LEVEL_DETECTOR_SPL 22
   #define DEVICE_ID_MSC 23
   #define DEVICE_ID_SPI 24
   
   #define DEVICE_ID_DISTANCE            25
   #define DEVICE_ID_GYROSCOPE           26
   #define DEVICE_ID_HUMIDITY            27
   #define DEVICE_ID_PRESSURE            28
   
   #define DEVICE_ID_SINGLE_WIRE_SERIAL 29
   #define DEVICE_ID_JACDAC 30
   #define DEVICE_ID_JACDAC_PHYS 31
   #define DEVICE_ID_JACDAC_CONTROL_SERVICE 32
   #define DEVICE_ID_JACDAC_CONFIGURATION_SERVICE 33
   #define DEVICE_ID_SYSTEM_ADC          34
   #define DEVICE_ID_PULSE_IN            35
   #define DEVICE_ID_USB 36
   #define DEVICE_ID_SPLITTER            37
   #define DEVICE_ID_AUDIO_PROCESSOR     38
   #define DEVICE_ID_TAP                 39
   #define DEVICE_ID_POWER_MANAGER       40
   
   // Slightly dubious IDs, moved here for now to remove conflicts
   #define DEVICE_ID_PARTIAL_FLASHING    41
   #define DEVICE_ID_USB_FLASH_MANAGER   42
   #define DEVICE_ID_VIRTUAL_SPEAKER_PIN 43
   #define DEVICE_ID_LOG                 44
   
   // Suggested range for device-specific IDs: 50-79
   // NOTE - not final, just suggested currently.
   
   #define DEVICE_ID_IO_P0               100                       // IDs 100-227 are reserved for I/O Pin IDs.
   
   #define DEVICE_ID_MESSAGE_BUS_LISTENER            1021          // Message bus indication that a handler for a given ID has been registered.
   #define DEVICE_ID_NOTIFY_ONE                      1022          // Notfication channel, for general purpose synchronisation
   #define DEVICE_ID_NOTIFY                          1023          // Notfication channel, for general purpose synchronisation
   
   #define DEVICE_ID_BUTTON_UP 2000
   #define DEVICE_ID_BUTTON_DOWN 2001
   #define DEVICE_ID_BUTTON_LEFT 2002
   #define DEVICE_ID_BUTTON_RIGHT 2003
   
   // jacadac reserved from 3000 - 4000
   #define DEVICE_ID_JD_DYNAMIC_ID 3000
   
   
   // Universal flags used as part of the status field
   #define DEVICE_COMPONENT_RUNNING                0x1000
   
   #define DEVICE_COMPONENT_STATUS_SYSTEM_TICK     0x2000
   #define DEVICE_COMPONENT_STATUS_IDLE_TICK       0x4000
   
   #define DEVICE_COMPONENT_LISTENERS_CONFIGURED   0x01
   
   #define DEVICE_COMPONENT_EVT_SYSTEM_TICK        1
   
   namespace codal
   {
       class CodalComponent
       {
           static uint8_t configuration;
   
           public:
           void addComponent();
   
           void removeComponent();
   
           static CodalComponent* components[DEVICE_COMPONENT_COUNT];
   
           uint16_t id;                    // Event Bus ID of this component
           uint16_t status;                // Component defined state.
   
           CodalComponent()
           {
               this->id = 0;
               this->status = 0;
   
               addComponent();
           }
   
           CodalComponent(uint16_t id, uint16_t status)
           {
               this->id = id;
               this->status = status;
   
               addComponent();
           }
   
           virtual int init() { return DEVICE_NOT_SUPPORTED; }
   
           virtual void periodicCallback() {}
   
           virtual void idleCallback() {}
   
           virtual int setSleep(bool doSleep) { return DEVICE_NOT_SUPPORTED; }
   
           static void setAllSleep(bool doSleep);
   
           typedef enum deepSleepCallbackReason
           {
               deepSleepCallbackPrepare,           //Prepare for sleep
               deepSleepCallbackBegin,             //Puts the component in sleep (low power) mode.
               deepSleepCallbackBeginWithWakeUps,  //and enable wake-up sources
               deepSleepCallbackEnd,               //Brings the component out of sleep (low power) mode.
               deepSleepCallbackEndWithWakeUps,    //and disable wake-up sources
               deepSleepCallbackCountWakeUps,      //Count deep sleep wake-up sources.
               deepSleepCallbackClearWakeUps       //Clear deep sleep wake up sources
           } deepSleepCallbackReason;
   
           typedef struct deepSleepCallbackData
           {
               int count;
   
               void init() { count = 0; }
   
               deepSleepCallbackData() { init(); }
           } deepSleepCallbackData;
   
           virtual int deepSleepCallback( deepSleepCallbackReason reason, deepSleepCallbackData *data);
   
           static void deepSleepAll( deepSleepCallbackReason reason, deepSleepCallbackData *data);
   
           virtual ~CodalComponent()
           {
               status = 0;
               removeComponent();
           }
       };
   }
   
   #endif
